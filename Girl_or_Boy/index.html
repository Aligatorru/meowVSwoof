<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ÐœÐ°Ð»ÑŒÑ‡Ð¸ÐºÐ¸-Ð´ÐµÐ²Ð¾Ñ‡ÐºÐ¸</title>
  <style>
    body {
      margin: 0;
      min-height: 100vh;
      background: linear-gradient(to bottom, #ffe0e6, #cce8ff);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
        Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 20px;
      text-align: center;
      color: #333;
    }

    .character-selection {
      margin-bottom: 20px;
      display: flex;
      gap: 20px;
    }

    .character-selection button {
      font-size: 2.5rem;
      padding: 10px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      background: white;
      transition: transform 0.2s;
    }

    .character-selection button:hover {
      transform: scale(1.1);
    }

    .board {
      display: grid;
      grid-template-columns: repeat(3, 100px);
      grid-template-rows: repeat(3, 100px);
      gap: 8px;
      margin-bottom: 20px;
    }

    .cell {
      background: #fff;
      border: 1.5px solid #ccc;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      cursor: pointer;
      transition: background-color 0.2s, border-color 0.2s;
      width: 100px;
      height: 100px;
      box-sizing: border-box;
    }

    .cell.taken {
      cursor: default;
    }

    .cell.winning-boy {
      background-color: #cce8ff;
      border-color: #4a90e2;
      color: #155dbe;
      font-weight: 700;
    }

    .cell.winning-girl {
      background-color: #f0c7e6;
      border-color: #eaaccb;
      color: #b94fa4;
      font-weight: 700;
    }

    #message {
      font-size: 1.3rem;
      min-height: 2em;
      text-align: center;
      margin-bottom: 15px;
    }

    #reset {
      padding: 10px 25px;
      font-size: 1rem;
      border: none;
      border-radius: 8px;
      background-color: #4caf50;
      color: white;
      cursor: pointer;
    }

    @media (max-width: 400px) {
      .board {
        grid-template-columns: repeat(3, 80px);
        grid-template-rows: repeat(3, 80px);
      }

      .cell {
        font-size: 2rem;
        width: 80px;
        height: 80px;
      }

      .character-selection button {
        font-size: 2rem;
      }
    }
  </style>
</head>

<body>
  <h1>ÐœÐ°Ð»ÑŒÑ‡Ð¸ÐºÐ¸-Ð´ÐµÐ²Ð¾Ñ‡ÐºÐ¸</h1>
  <div id="message">Ð’Ñ‹Ð±ÐµÑ€Ð¸ Ð·Ð° ÐºÐ¾Ð³Ð¾ Ð±ÑƒÐ´ÐµÑˆÑŒ Ð¸Ð³Ñ€Ð°Ñ‚ÑŒ</div>
  <div class="character-selection" id="characterSelection">
    <div class="character-option">
      <button onclick="selectCharacter('boy')">ðŸ‘¦</button>
      <div class="label">Ð¼Ð°Ð»ÑŒÑ‡Ð¸Ðº</div>
    </div>
    <div class="character-option">
      <button onclick="selectCharacter('girl')">ðŸ‘§</button>
      <div class="label">Ð´ÐµÐ²Ð¾Ñ‡ÐºÐ°</div>
    </div>
  </div>
  <div class="board" id="board" style="display:none;"></div>
  <button id="reset" onclick="resetGame()">Ð—Ð°Ð½Ð¾Ð²Ð¾</button>

  <script>
    const WINNER = "boy"; // Ð¸Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð½Ð° "boy" Ð¸Ð»Ð¸ "girl"
    const excuses = [
      "ÐžÐ¹, Ð¼Ð½Ðµ ÑÑ€Ð¾Ñ‡Ð½Ð¾ Ð½ÑƒÐ¶Ð½Ð¾ Ð¸Ð´Ñ‚Ð¸!",
      "Ð§Ñ‚Ð¾-Ñ‚Ð¾ Ñƒ Ð¼ÐµÐ½Ñ Ð¿Ð¾Ð´Ð²Ð¸ÑÐ»Ð¾, Ð´Ð°Ð²Ð°Ð¹ Ð¿Ð¾Ñ‚Ð¾Ð¼?",
      "Ð¢Ñ‹ ÑƒÐ²ÐµÑ€ÐµÐ½(Ð°), Ñ‡Ñ‚Ð¾ Ð²ÑÑ‘ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾? ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÑ‚Ð¸!",
      "Ð¯ Ñ‚Ð°Ðº Ð½Ðµ Ð¸Ð³Ñ€Ð°ÑŽ ðŸ˜ ",
      "ÐÐµ Ð¼Ð¾Ð³Ñƒ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð°Ñ‚ÑŒ. Ð¡Ñ€Ð¾Ñ‡Ð½Ð¾ Ð½ÑƒÐ¶Ð½Ð¾ Ð½Ð° Ð“Ð•ÐÐ”Ð•Ð  ÐŸÐÐ¢Ð˜!"
    ];
    const thinkingMessages = ["Ð¥Ð¼Ð¼...", "Ð”ÑƒÐ¼Ð°ÑŽ...", "Ð¡ÐµÐºÑƒÐ½Ð´Ð¾Ñ‡ÐºÑƒ...", "Ð¡Ð»Ð¾Ð¶Ð½Ñ‹Ð¹ Ð²Ñ‹Ð±Ð¾Ñ€..."];
    let player = null;
    let computer = null;
    let board = Array(9).fill(null);
    let currentPlayer = null;
    let gameOver = false;
    let allowClick = true;

    function selectCharacter(chosen) {
      player = chosen;
      computer = player === "boy" ? "girl" : "boy";
      document.getElementById("characterSelection").style.display = "none";
      document.getElementById("board").style.display = "grid";
      currentPlayer = "player";
      drawBoard();
      setMessage("Ð’Ð°Ñˆ Ñ…Ð¾Ð´!");
    }

    function drawBoard() {
      const boardDiv = document.getElementById("board");
      boardDiv.innerHTML = "";
      board.forEach((cell, idx) => {
        const cellDiv = document.createElement("div");
        cellDiv.className = "cell";
        if (cell) {
          cellDiv.textContent = cell === "boy" ? "ðŸ‘¦" : "ðŸ‘§";
          cellDiv.classList.add("taken");
        }
        cellDiv.onclick = () => handleMove(idx);
        boardDiv.appendChild(cellDiv);
      });
    }

    function handleMove(idx) {
      if (gameOver || !allowClick || board[idx]) return;
      board[idx] = player;
      drawBoard();
      if (checkWin(player)) {
        endGame(player);
        return;
      }
      if (!board.includes(null)) {
        endGame(null);
        return;
      }
      currentPlayer = "computer";
      allowClick = false;
      setMessage(thinkingMessages[Math.floor(Math.random() * thinkingMessages.length)]);
      setTimeout(() => {
        makeComputerMove();
        drawBoard();
        if (checkWin(computer)) {
          if (player === WINNER) {
            fakeExcuse();
            return;
          }
          endGame(computer);
          return;
        }
        if (!board.includes(null)) {
          endGame(null);
          return;
        }
        currentPlayer = "player";
        allowClick = true;
        setMessage("Ð’Ð°Ñˆ Ñ…Ð¾Ð´!");
      }, 1000 + Math.random() * 2000);
    }

    function makeComputerMove() {
      let move = getBestMove();
      board[move] = computer;
    }

    function getBestMove() {
      const emptyIndices = board.map((v, i) => v === null ? i : null).filter(i => i !== null);
      if (player !== WINNER) {
        return minimax(board, computer).index;
      } else {
        // Ð”ÐµÐ»Ð°Ñ‚ÑŒ ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½Ñ‹Ð¹ Ð½ÐµÐ¸Ð´ÐµÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ñ…Ð¾Ð´
        return emptyIndices[Math.floor(Math.random() * emptyIndices.length)];
      }
    }

    function checkWin(symbol) {
      const wins = [
        [0, 1, 2], [3, 4, 5], [6, 7, 8],
        [0, 3, 6], [1, 4, 7], [2, 5, 8],
        [0, 4, 8], [2, 4, 6]
      ];
      return wins.find(comb => comb.every(i => board[i] === symbol));
    }

    function endGame(winner) {
      gameOver = true;
      const winCombo = checkWin(winner);
      if (winCombo) {
        winCombo.forEach(i => {
          document.querySelectorAll(".cell")[i].classList.add(winner === "boy" ? "winning-boy" : "winning-girl");
        });
        setMessage(winner === "boy" ? "Ð­Ñ‚Ð¾ Ð¼Ð°Ð»ÑŒÑ‡Ð¸Ðº!" : "Ð­Ñ‚Ð¾ Ð´ÐµÐ²Ð¾Ñ‡ÐºÐ°!");
      } else {
        setMessage("ÐÐ¸Ñ‡ÑŒÑ! ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹ ÐµÑ‰Ñ‘ Ñ€Ð°Ð·!");
      }
    }

    function fakeExcuse() {
      gameOver = true;
      setMessage(excuses[Math.floor(Math.random() * excuses.length)]);
    }

    function setMessage(msg) {
      document.getElementById("message").textContent = msg;
    }

    function resetGame() {
      board = Array(9).fill(null);
      gameOver = false;
      allowClick = true;
      player = null;
      computer = null;
      currentPlayer = null;
      document.getElementById("characterSelection").style.display = "flex";
      document.getElementById("board").style.display = "none";
      setMessage("Ð’Ñ‹Ð±ÐµÑ€Ð¸ ÐµÑ‰Ñ‘ Ñ€Ð°Ð·, Ð·Ð° ÐºÐ¾Ð³Ð¾ Ð±ÑƒÐ´ÐµÑˆÑŒ Ð¸Ð³Ñ€Ð°Ñ‚ÑŒ");
    }

    function minimax(newBoard, playerSymbol) {
      const availSpots = newBoard.map((v, i) => v === null ? i : null).filter(i => i !== null);

      if (checkWin(player)) return { score: -10 };
      if (checkWin(computer)) return { score: 10 };
      if (availSpots.length === 0) return { score: 0 };

      const moves = [];

      for (let i = 0; i < availSpots.length; i++) {
        const move = {};
        move.index = availSpots[i];
        newBoard[availSpots[i]] = playerSymbol;

        const result = minimax(newBoard, playerSymbol === computer ? player : computer);
        move.score = result.score;

        newBoard[availSpots[i]] = null;
        moves.push(move);
      }

      let bestMove;
      if (playerSymbol === computer) {
        let bestScore = -Infinity;
        for (let i = 0; i < moves.length; i++) {
          if (moves[i].score > bestScore) {
            bestScore = moves[i].score;
            bestMove = i;
          }
        }
      } else {
        let bestScore = Infinity;
        for (let i = 0; i < moves.length; i++) {
          if (moves[i].score < bestScore) {
            bestScore = moves[i].score;
            bestMove = i;
          }
        }
      }

      return moves[bestMove];
    }
  </script>
</body>

</html>
